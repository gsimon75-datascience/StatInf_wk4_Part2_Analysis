---
title: |
 | Statistical Inference
 | Analysis of the ToothGrowth data
author: "Gabor Simon"
output: 
  pdf_document:
          toc: true
---


## Overview

We are doing an Inferential Data Analysis on the ToothGrowth dataset of the
R library 'datasets': "The Effect of Vitamin C on Tooth Growth in Guinea Pigs".

```{r setup_environment, message = FALSE}
library(datasets)
library(dplyr)
library(ggplot2)
# We want the same data on each run
set.seed(1507471380)
```

The built-in help of the dataset says:

>     ...
>     Description:
>          The response is the length of odontoblasts (cells responsible for
>          tooth growth) in 60 guinea pigs.  Each animal received one of
>          three dose levels of vitamin C (0.5, 1, and 2 mg/day) by one of
>          two delivery supplements, (orange juice or ascorbic acid (a form of
>          vitamin C and coded as 'VC').
>     
>     Format:
>          A data frame with 60 observations on 3 variables.
>            [,1]  len   numeric  Tooth length                
>            [,2]  supp  factor   Supplement type (VC or OJ). 
>            [,3]  dose  numeric  Dose in milligrams/day      
>     ...

## Exploratory Data Analysis

To get some first-glance ideas, let's take a look at the data.

### The tooth length distributions by dose and supplement type
```{r eda_1, message = FALSE}
ggplot(ToothGrowth, aes(factor(dose), len)) + facet_grid(~supp) + geom_boxplot()
```

### The individual sample distributions for each (dose,supp) pair
```{r eda_2, message = FALSE}
ggplot(ToothGrowth, aes(len)) + facet_grid(dose~supp) + geom_histogram(bins=20)
```

### Our approximate observations
1. For both supplements, higher doses result longer teeth
2. For 0.5 and 1.0 mg/day, the 'OJ' supplement results longer teeth than the 'VC'
3. For 2.0 mg/day, the difference is insignificant
4. Due to the low number of samples, the distributions are not recognisable
   as normals, but they aren't that sloped either.


## Basic Inferential Data Analysis

So our null hypotheses will be that all dosages and supplements result the same
tooth growth, and the alternative hypotheses will be that one (dose,supp) pair
results more than the other.

This will give us quite a number of hypotheses, so the pitfalls of multiple
testing shall be considered as well.

As we cannot assume the distributions to be normal, we resort to t-tests.

The following wrapper functions make such tests easier:

```{r test_wrapper, message = FALSE}

# Test whether the tooth length in case of {dose,supp}A is greater than for {dose,supp}0
# H0: len(dose0, supp0) = len(doseA, suppA)
# HA: len(dose0, supp0) < len(doseA, suppA)
# If the p-value is low enough, then H0 can be rejected and HA may be assumed true
# If the p-value is too high, then we failed to reject H0
test_tg <- function(dose0, supp0, doseA, suppA) {
	t.test(ToothGrowth$len[ToothGrowth$dose == doseA & ToothGrowth$supp == suppA],
	       ToothGrowth$len[ToothGrowth$dose == dose0 & ToothGrowth$supp == supp0], alternative="greater")
}

# Test the two {dose,supp}{0,A} pairs in both directions and print the p-values
test_and_print <- function(dose0, supp0, doseA, suppA) {
	descr_fwd <- paste("HA={ (", doseA, ",", suppA, ") more effective than (", dose0, ",", supp0, ") }", sep = "")
	print(paste(descr_fwd, test_tg(dose0, supp0, doseA, suppA)$p.value))
	descr_rev <- paste("HA={ (", dose0, ",", supp0, ") more effective than (", doseA, ",", suppA, ") }", sep = "")
	print(paste(descr_rev, test_tg(doseA, suppA, dose0, supp0)$p.value))
	#print(paste("HA={ (", doseA, ",", suppA, ") more effective than (", dose0, ",", supp0, ") }: ", test_tg(dose0, supp0, doseA, suppA)$p.value, sep = ""))
	#print(paste("HA={ (", dose0, ",", supp0, ") more effective than (", doseA, ",", suppA, ") }: ", test_tg(doseA, suppA, dose0, supp0)$p.value, sep = ""))
}

# Check whether OJ > VC with @dose, or the opposite, or neither
test_dose <- function(dose) {
	test_and_print(dose, "VC", dose, "OJ")
}

# Check whether 2.0 > 1.0 > 0.5 for @supp, or the opposite, or neither
test_supplement <- function(supp) {
	test_and_print(0.5, supp, 1.0, supp)
	test_and_print(1.0, supp, 2.0, supp)
}
```

### The p-values for our hypotheses!

Remember, for all the following tests the null hypothesis H0 is that
both (dose,supp) pairs are equally efficient, and if a **p-value is low enough**, then
that we reject this H0 and **accept HA as true**.

### Testing hypothesis about doses

For each dose we have two alternative hypotheses ("VC > OJ" and "OJ > VC"),
so we can even afford a Bonferroni correction and simply choose an $\alpha$ half
of what we originally wanted.

```{r test_dose_hypotheses, message = FALSE}
test_dose(0.5)
test_dose(1.0)
test_dose(2.0)
```

\pagebreak

### Testing hypothesis about supplements

```{r test_supp_hypotheses, message = FALSE}
test_supplement("VC")
test_supplement("OJ")
```


## Conclusions

1. For both supplement type the higher dose is more effective ($\alpha < 0.02$)
2. For doses 0.5 and 1.0 mg/day, "OJ" is more effective than "VC" ($\alpha < 0.0032$)
3. For 2.0 mg/day there is no significant difference between the supplements' effectiveness.

